<!DOCTYPE html>
<html lang="he">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Stirboul Summoner</title>
<style>
  body { margin:0; font-family: Arial; background:black; color:red; text-align:center; }
  #container { padding:20px; }
  h1 { font-size:3rem; margin-top:40px; }
  input, button { padding:10px; font-size:1.2rem; }
  button { background:red; border:none; color:black; cursor:pointer; }
  #countdown { font-size:3rem; margin-top:40px; }
  #others, #futureSummons { position:fixed; right:0; top:0; background: rgba(255,0,0,0.15); width:300px; height:100%; padding:10px; overflow-y:auto; border-left:1px solid red; }
  #futureSummons { right: 310px; border-left:none; display:none; }
  .entry { margin-bottom:10px; border-bottom:1px solid red; padding-bottom:10px; cursor:pointer; }
  #openFuture { position:fixed; right:0; top:50%; transform:translateY(-50%); background:red; color:black; padding:5px 10px; cursor:pointer; }
  #fullScreenCountdown { position:fixed; top:0; left:0; width:100%; height:100%; background:black; color:red; font-size:5rem; display:flex; align-items:center; justify-content:center; z-index:9999; display:none; }
</style>
</head>
<body>
<div id="container">
  <h1>ברוך הבא לטקס ה‑Stirboul</h1>
  <div>
    <input id="username" placeholder="הכנס את שמך" />
    <input id="datetime" type="datetime-local" />
    <button onclick="summonSelf()">חפש את הזימונים שלך</button>
  </div>
  <div style="margin-top:20px">
    <input id="targetName" placeholder="שם אדם אחר" />
    <input id="targetDatetime" type="datetime-local" />
    <button onclick="summonOther()">זמן</button>
  </div>
  <div id="countdown"></div>
</div>

<div id="others">
  <h3>זימונים פעילים</h3>
  <div id="othersList"></div>
</div>

<div id="futureSummons">
  <h3>זימונים עתידיים</h3>
  <div id="futureList"></div>
</div>
<div id="openFuture" onclick="toggleFuture()">זימונים עתידיים ⯈</div>
<div id="fullScreenCountdown"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyDJc3JgIJ1-39x9S_NnqziatsMCQ4AvYjU",
  authDomain: "stirbul.firebaseapp.com",
  databaseURL: "https://stirbul-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "stirbul",
  storageBucket: "stirbul.firebasestorage.app",
  messagingSenderId: "466844431862",
  appId: "1:466844431862:web:13948fabcd6fe3615a03d7",
  measurementId: "G-NLMNY6K8WL"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function summon(name, endTime) {
  db.ref('summons').push({ name, end: endTime });
}

function summonSelf() {
  const n = document.getElementById('username').value.trim();
  const dt = document.getElementById('datetime').value;
  if(!n || !dt) return;
  const end = new Date(dt).getTime();
  summon(n,end);
  startPersonal(n,end);
}

function summonOther() {
  const n = document.getElementById('targetName').value.trim();
  const dt = document.getElementById('targetDatetime').value;
  if(!n || !dt) return;
  const end = new Date(dt).getTime();
  summon(n,end);
}

function startPersonal(name,end) {
  startCountdown({name,end});
}

function startCountdown(entry) {
  const countdown = document.getElementById('countdown');
  const fullScreen = document.getElementById('fullScreenCountdown');
  fullScreen.style.display='flex';
  const interval = setInterval(()=>{
    const remaining = entry.end - Date.now();
    if(remaining<=0){ fullScreen.innerHTML='זה מתחיל'; clearInterval(interval); return; }
    const days = Math.floor(remaining/86400000);
    const hours = Math.floor((remaining%86400000)/3600000);
    const mins = Math.floor((remaining%3600000)/60000);
    const secs = Math.floor((remaining%60000)/1000);
    fullScreen.innerHTML = `${days} ימים ${hours} שעות ${mins} דקות ${secs} שניות`;
  },500);
}

function toggleFuture(){
  const future = document.getElementById('futureSummons');
  future.style.display = future.style.display==='none'?'block':'none';
}

function renderOthers() {
  const container = document.getElementById('othersList');
  const futureContainer = document.getElementById('futureList');
  const userName = document.getElementById('username').value.trim();
  db.ref('summons').on('value', snap=>{
    container.innerHTML='';
    futureContainer.innerHTML='';
    const data = snap.val()||{};
    Object.values(data).forEach(s=>{
      const div = document.createElement('div');
      div.className='entry';
      function update(){
        const remaining = s.end - Date.now();
        if(s.name === userName){
          // skip in future list, already shown full screen if self
          return;
        }
        if(remaining>0){
          futureContainer.appendChild(div);
          div.innerHTML=`<b>${s.name}</b><br>נותר: ${Math.floor(remaining/86400000)} ימים ${Math.floor((remaining%86400000)/3600000)} שעות ${Math.floor((remaining%3600000)/60000)} דקות ${Math.floor((remaining%60000)/1000)} שניות`;
        } else {
          div.innerHTML=`<b>${s.name}</b><br>זה התחיל`;
          container.appendChild(div);
        }
      }
      update();
      setInterval(update,1000);
      container.appendChild(div);
    });
  });
}
renderOthers();
</script>
</body>
</html>
